# Configuration for the rpmlint utility.
# Loaded before ~/.rpmlintrc

# Configuration options used by the checks
CompressExtension = ""
UseVarLockSubsys = false
UseVersionInChangelog = false
BadnessThreshold = 1000

# TODO fix, it's failing now
[DanglingSymlinkExceptions]
[DanglingSymlinkExceptions."/usr/share/doc/licenses/"]
path = "/usr/share/doc/licenses/"
name = "licenses"
[DanglingSymlinkExceptions."consolehelper$"]
path = "consolehelper$"
name = "usermode-consoleonly"

[Details]
non-standard-uid = '''A file in this package is owned by an unregistered user id.
To register the user, please branch the devel:openSUSE:Factory:rpmlint rpmlint package,
add the user to the "config" file and send a submitrequest.
'''
non-standard-gid = '''A file in this package is owned by an unregistered group id.
To register the group, please branch the devel:openSUSE:Factory:rpmlint rpmlint package,
add the group to the "config" file and send a submitrequest.
'''
no-changelogname-tag = '''There is no changelog. Please insert a '%changelog' section heading in your
spec file and prepare your changes file using e.g. the 'osc vc' command.'''


# Enabled checks for the rpmlint to be run (besides the default set)
Checks = [
# TODO Uncomment security checks when they are ported
# Note: polkit-default-privs would need to be installed always
    #"CheckSUIDPermissions",
    #"CheckDBUSServices",
    #"CheckCronJobs",
    #"CheckPolkitPrivs",
    #"CheckWorldWritable",
    #"CheckDeviceFiles",
    "BrandingPolicyCheck",
    "FilelistCheck",
    "KMPPolicyCheck",
    "SystemdInstallCheck",
    "BashismsCheck",
    "PAMModulesCheck",
    "TmpFilesCheck",
    "SysVInitOnSystemdCheck",
]


Filters = [
# Stuff autobuild takes care about
    '.*invalid-version.*',
    '.*invalid-packager.*',
    '.*not-standard-release-extension.*',
    '.*invalid-buildhost.*',
    '.*executable-in-library-package.*',
    '.*non-versioned-file-in-library-package.*',
    '.*incoherent-version-in-name.*',
    '.*hardcoded-path-in-buildroot-tag.*',
    '.*no-buildroot-tag.*',
    '.*cross-directory-hard-link.*',

# Do not validate package rpm groups
    '.*devel-package-with-non-devel-group.*',
    '.*no-group-tag.*',
    '.*non-standard-group.*',

# Output filters
    '.*spurious-bracket-in-.*',
    '.*one-line-command-in-.*',
    ' dir-or-file-in-opt ',  # handled by CheckFilelist.py
    ' dir-or-file-in-usr-local ',  # handled by CheckFilelist.py
    ' non-standard-dir-in-usr ',  # handled by CheckFilelist.py
    'incoherent-version-in-changelog',
    ' no-signature',
    ' symlink-crontab-file',  #bnc591431
    ' without-chkconfig',
    'unstripped-binary-or-object.*\.ko',
    ' no-chkconfig',
    ' subsys-not-used',
    ' dangerous-command.*',
    ' setuid-binary.*',
    'subdir-in-bin /sbin/conf.d/',
    '.* nss_db non-standard-dir-in-var db',
    'non-standard-dir-in-usr openwin',
    'ibcs2 non-standard-dir-in-usr i486-sysv4',
    'shlibs5 non-standard-dir-in-usr i486-linux-libc5',
    'explicit-lib-dependency libtool',

# Filesystem package needs special exceptions
    '^filesystem\..*: dir-or-file-in-var-run',
    '^filesystem\..*: dir-or-file-in-var-lock',
    '^filesystem\..*: dir-or-file-in-var-tmp',
    '^filesystem\..*: dir-or-file-in-var-run',
    '^filesystem\..*: dir-or-file-in-var-lock',
    '^filesystem\..*: dir-or-file-in-usr-tmp',
    '^filesystem\..*: dir-or-file-in-tmp',
    '^filesystem\..*: dir-or-file-in-mnt',
    '^filesystem\..*: dir-or-file-in-home',
    '^filesystem\..*: hidden-file-or-dir /root/.gnupg',
    '^filesystem\..*: hidden-file-or-dir /root/.gnupg',
    '^filesystem\..*: hidden-file-or-dir /etc/skel/.config',
    '^filesystem\..*: hidden-file-or-dir /etc/skel/.local',
    '^filesystem\..*: hidden-file-or-dir /tmp/.X11-unix',
    '^filesystem\..*: hidden-file-or-dir /tmp/.ICE-unix',
    '^filesystem\..*: hidden-file-or-dir /etc/skel/.fonts',
    '^filesystem\..*: filelist-forbidden-fhs23',
    '^filesystem\..*: filelist-forbidden-opt',
    '^filesystem\..*: non-standard-uid /var/lib/nobody nobody',
    '^filesystem\..*: missing-dependency-to-cron',
# has arch specific dirs in /usr
    '^filesystem\..*: no-binary',

# Suppress any errors about internal packages
    '^qa\S+: [EWI]:',
    '^\S*(?:INTERNAL|internal)\.\S+: [EWI]:',

# Exceptions for devel-files
    'devel-file-in-non-devel-package.*/boot/vmlinuz-.*autoconf.h',
    'devel-file-in-non-devel-package.*/usr/src/linux-',
    'devel-file-in-non-devel-package.*/usr/share/systemtap',
    'kde4-kapptemplate\.\S+:.*devel-file-in-non-devel-package',
    'kdesdk3\.\S+:.*devel-file-in-non-devel-package',
    '-(?:examples|doc)\.\S+: \w: devel-file-in-non-devel-package',
    'java\S+-demo\.\S+: \w: devel-file-in-non-devel-package',
    'avr-libc\.\S+: \w: devel-file-in-non-devel-package',
    'dietlibc\.\S+ \w: devel-file-in-non-devel-package',
    'cross-.*devel-file-in-non-devel-package',
    'cmake.*devel-file-in-non-devel-package',
    'gcc\d\d.*devel-file-in-non-devel-package',
    'OpenOffice_org-sdk\.\S+: \w: devel-file-in-non-devel-package',
    'wnn-sdk\.\S+: \w: devel-file-in-non-devel-package',
    'ocaml\.\S+: \w: devel-file-in-non-devel-package',
    'xorg-x11-server-sdk\.\S+: \w: devel-file-in-non-devel-package',
    'linux-kernel-headers\.\S+: \w: devel-file-in-non-devel-package',
    ' devel-file-in-non-devel-package.*-config',
    'libtool\.\S+: \w: devel-file-in-non-devel-package',
    'sdb.* dangling-relative-symlink /usr/share/doc/sdb/.*/gifs ../gifs',
    'kernel-modules-not-in-kernel-packages',

# SUSE kmp's don't need manual depmod (bnc#456048)
    'module-without-depmod-postin',
    'postin-with-wrong-depmod',
    'module-without-depmod-postun',
    'postun-with-wrong-depmod',
    'configure-without-libdir-spec',
    'conffile-without-noreplace-flag /etc/init.d',
    'use-of-RPM_SOURCE_DIR',
    'use-tmp-in-',
    'symlink-contains-up-and-down-segments /var/lib/named',
    'no-ldconfig-symlink',
    'aaa_base\.\S+: \w: use-of-home-in-%post',
    'description-line-too-long',
    'hardcoded-library-path',

# Doesn't seem to make sense
    'invalid-ldconfig-symlink',
    'invalid-soname',
    'library-not-linked-against-libc',
    'only-non-binary-in-usr-lib',
    'outside-libdir-files',

# We want these files
    ' perl-temp-file ',
    ' hidden-file-or-dir .*/\.packlist',
    ' hidden-file-or-dir .*/\.directory',
    'perl-.*no-binary',
    ' no-major-in-name ',

# We check for that already
    'dangling-relative-symlink',
    ' lib-package-without-%mklibname',
    ' requires-on-release',
    ' non-executable-script /etc/profile.d/',
    ' non-executable-script /var/adm/fillup-templates/',
    ' init-script-name-with-dot ',
    '.* statically-linked-binary /sbin/ldconfig',
    '.* statically-linked-binary /sbin/init',
    'valgrind.* statically-linked-binary',
    'ldconfig-post.*/ddiwrapper/wine/',
    'glibc\.\S+: \w: statically-linked-binary /usr/sbin/glibc_post_upgrade',
    ' symlink-should-be-relative ',
    ' binary-or-shlib-defines-rpath .*ORIGIN',
    'libzypp.*shlib-policy-name-error.*libzypp',
    'libtool.*shlib-policy.*',

# Stuff that is currently too noisy, but might become relevant in the future
    ' prereq-use',
    ' file-not-utf8',
    ' tag-not-utf8',
    ' setup-not-quiet',
    ' no-cleaning-of-buildroot ',
    ' mixed-use-of-spaces-and-tabs ',
    ' prereq-use ',

# An issue with OBS, works with autobuild
    ' no-packager-tag',
    ' unversioned-explicit-provides ',
    ' unversioned-explicit-obsoletes ',
    ' service-default-enabled ',
    ' non-standard-dir-perm ',
    ' conffile-without-noreplace-flag ',
    ' non-standard-executable-perm ',
    ' jar-not-indexed ',
    ' uncompressed-zip ',
    ' %ifarch-applied-patch ',
    ' read-error ',
    ' init-script-without-chkconfig-postin ',
    ' init-script-without-chkconfig-preun ',
    ' postin-without-chkconfig ',
    ' preun-without-chkconfig ',
    ' no-dependency-on locales',
    ' incoherent-version-in-name',
    ' binary-or-shlib-defines-rpath',
    ' executable-marked-as-config-file',
    ' log-files-without-logrotate',
    ' hardcoded-prefix-tag',
    ' no-documentation',
    ' multiple-specfiles',
    ' no-default-runlevel ',
    ' setgid-binary ',
    ' non-readable ',
    ' postin-without-ghost-file-creation ',

# Exceptions for filelist checks
    'nfs-client\.\S+: \w: filelist-forbidden-backup-file /var/lib/nfs/sm.bak ',
    'perl\.\S+: \w: filelist-forbidden-perl-dir ',
    'info\.\S+: \w: info-dir-file .*/usr/share/info/dir',

# These packages are used for CD creation and are not supposed to be
# installed. It's still a dirty hack to make an exception. The
# packages should either be built in a separate project with
# different config or file be put somewhere below /opt/suse/*
    '(?:dosutils|skelcd|installation-images|yast2-slide-show|instlux|skelcd-.*|patterns-.*)\.\S+: \w: filelist-forbidden-fhs23 /CD1',

# Too noisy, and usually not something downstream packagers can fix
    ' incorrect-fsf-address ',
    ' no-manual-page-for-binary ',
    ' static-library-without-debuginfo /usr/lib(?:64)?/ghc-[\d\.]+/',

# The libre mess
    'libre(?:ssl|office|cad)[^\:]+: \w: shlib-policy-',

# Many places have shorter paths
    ' non-coherent-filename ',

# Mandriva specific stuff that we don't want
    ' invalid-build-requires ',
    ' no-provides ',

# Bash completion files are not scripts, do not require them marked as %config
    'W: non-conffile-in-etc /etc/bash_completion.d/',

# Info uses file triggers now (boo#1152169)
    ' info-files-without-install-info-postin' ,
    ' postin-without-install-info ',
    ' info-files-without-install-info-postun ',
    ' postin-without-install-info ',
]

PAMModulesWhiteList = [
    # pam_krb5
    "pam_krb5.so",
    "pam_krb5afs.so",
    # ecryptfs-utils
    "pam_ecryptfs.so",
    # gnome-keyring-pam
    "pam_gnome_keyring.so",
    # samba-winbind
    "pam_winbind.so",
    # pam_ssh
    "pam_ssh.so",
    # pam_mount
    "pam_mount.so",
    # pam_ccreds
    "pam_ccreds.so",
    # pam_radius
    "pam_radius_auth.so",
    # pam_pkcs11
    "pam_pkcs11.so",
    # nss-pam-ldapd
    "pam_ldap.so",
    # pam_passwdqc
    "pam_passwdqc.so",
    # pam_userpass
    "pam_userpass.so",
    # pam_apparmor
    "pam_apparmor.so",
    # pam_ldap
    "pam_ldap.so",
    # opie
    "pam_opie.so",
    # pam
    "pam_access.so",
    "pam_cracklib.so",
    "pam_debug.so",
    "pam_deny.so",
    "pam_echo.so",
    "pam_env.so",
    "pam_exec.so",
    "pam_faildelay.so",
    "pam_filter.so",
    "pam_ftp.so",
    "pam_group.so",
    "pam_issue.so",
    "pam_keyinit.so",
    "pam_lastlog.so",
    "pam_limits.so",
    "pam_listfile.so",
    "pam_localuser.so",
    "pam_loginuid.so",
    "pam_mail.so",
    "pam_mkhomedir.so",
    "pam_motd.so",
    "pam_namespace.so",
    "pam_nologin.so",
    "pam_permit.so",
    "pam_pwhistory.so",
    "pam_rhosts.so",
    "pam_rootok.so",
    "pam_securetty.so",
    "pam_selinux.so",
    "pam_sepermit.so",
    "pam_shells.so",
    "pam_stress.so",
    "pam_succeed_if.so",
    "pam_tally2.so",
    "pam_time.so",
    "pam_timestamp.so",
    "pam_tty_audit.so",
    "pam_umask.so",
    "pam_unix.so",
    "pam_unix_acct.so",
    "pam_unix_auth.so",
    "pam_unix_passwd.so",
    "pam_unix_session.so",
    "pam_userdb.so",
    "pam_warn.so",
    "pam_wheel.so",
    "pam_xauth.so",
    # systemd
    "pam_systemd.so",
    # sssd
    "pam_sss.so",
    # pam_mktemp
    "pam_mktemp.so",
    # pam_csync
    "pam_csync.so",
    # pam_chroot
    "pam_chroot.so",
    # pam_snapper (bnc#815383)
    "pam_snapper.so",
    # pam_gdm (bsc#1004346)
    "pam_gdm.so",
    # pam_slurm (bsc#1007053)
    "pam_slurm.so",
    # pam_slurm_adopt (bsc#1116758)
    "pam_slurm_adopt.so",
    # pam_script (bsc#1039848)
    "pam_script.so",
    # pam_yubico (bsc#1087060)
    "pam_yubico.so",
    # pam_oath (bsc#1089114)
    "pam_oath.so",
    # pam_p11 (bsc#1123916)
    "pam_p11.so",
    # pam_cifscreds (bsc#1150527)
    "pam_cifscreds.so",
    # libpwquality (bsc#1150520)
    "pam_pwquality.so",
    # lxc (bsc#1150519)
    "pam_cgfs.so",
    # google-authenticator-libpam (bsc#1150524) - potential future removal candidate
    "pam_google_authenticator.so",
    # pam_u2f (bsc#1087061)
    "pam_u2f.so",
    # pam_kwallet (bsc#993806)
    "pam_kwallet5.so",
    # pam_dbus (bsc#1039709)
    "pam_dbus.so",
    # google-compute-engine (bsc#1146353)
    "pam_oslogin_admin.so",
    "pam_oslogin_login.so",
    # fprintd (bsc#792095)
    "pam_fprintd.so",
    # mariadb (bsc#1163362)
    "pam_user_map.so",
    # oddjob (bsc#1169494)
    "pam_oddjob_mkhomedir.so",
    # cockpit (bsc#1169614)
    "pam_cockpit_cert.so",
    "pam_ssh_add.so",
    # pam (bsc#1171564)
    "pam_usertype.so",
    # pam (bsc#1171563)
    "pam_setquota.so",
    # kanidm (bsc#1173387)
    "pam_kanidm.so"
]

